<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jQuery ç·´ç¿’åä¸ƒï¼šåŠ å…¥ã€Œå®Œæˆç‡çµ±è¨ˆï¼†é€²åº¦æ¢ã€</title>
    <button id="toggleDarkMode" style="float: right;">ğŸŒ™ å¤œé–“æ¨¡å¼</button>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        input,
        select,
        button {
            padding: 8px;
            margin: 5px 5px 5px 0;
        }

        .filter-btns {
            margin: 10px 0;
        }

        .filter-btns button {
            padding: 5px 10px;
            margin-right: 5px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .filter-btns .active {
            background: #444;
            color: white;
        }

        #searchInput {
            width: 250px;
        }

        ul {
            margin-top: 20px;
            padding-left: 0;
        }

        li {
            list-style: none;
            padding: 10px;
            background: #f8f8f8;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        li.done .item-text {
            text-decoration: line-through;
            color: gray;
        }

        .deadline {
            font-size: 12px;
            color: #555;
            margin-left: 10px;
        }

        .expired {
            color: red;
            font-weight: bold;
        }

        .delete-btn {
            background: red;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
        }

        .item-left {
            display: flex;
            flex-direction: column;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 5px;
            width: fit-content;
        }

        .tag.å·¥ä½œ {
            background: #ffcc00;
            color: #000;
        }

        .tag.ç”Ÿæ´» {
            background: #66ccff;
            color: #000;
        }

        .tag.å­¸ç¿’ {
            background: #99cc66;
            color: #000;
        }

        body.dark {
            background-color: #1e1e1e;
            color: #f0f0f0;
        }

        body.dark input,
        body.dark select,
        body.dark button,
        body.dark #searchInput {
            background-color: #333;
            color: #fff;
            border: 1px solid #555;
        }

        body.dark li {
            background: #2a2a2a;
        }

        body.dark .filter-btns .active {
            background: #fff;
            color: #000;
        }

        body.dark .deadline {
            color: #aaa;
        }

        body.dark .tag.å·¥ä½œ {
            background: #ffe066;
            color: #000;
        }

        body.dark .tag.ç”Ÿæ´» {
            background: #66d9ef;
            color: #000;
        }

        body.dark .tag.å­¸ç¿’ {
            background: #a9dc76;
            color: #000;
        }

        #progressBar {
            transition: width 0.3s ease;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
                font-size: 4vw;
            }

            #todoInput,
            #deadlineInput,
            #categorySelect,
            #addBtn,
            #searchInput {
                width: 100%;
                box-sizing: border-box;
                margin-bottom: 10px;
            }

            .filter-btns {
                display: flex;
                flex-wrap: wrap;
            }

            .filter-btns button {
                flex: 1 1 30%;
                margin-bottom: 5px;
            }

            li {
                flex-direction: column;
                align-items: flex-start;
            }

            .delete-btn {
                align-self: flex-end;
                margin-top: 5px;
            }

            #toggleDarkMode {
                position: fixed;
                top: 10px;
                right: 10px;
                z-index: 999;
            }
        }

        @media (min-width: 601px) {
            body {
                font-size: 16px;
            }
        }
    </style>
</head>

<body>

    <h2>ğŸ” æ”¯æ´åˆ†é¡ + é—œéµå­—çš„ To-do æœå°‹</h2>

    <div id="progressContainer" style="margin: 15px 0;">
        <label>å®Œæˆç‡ï¼š<span id="progressText">0%</span></label>
        <div style="background: #ddd; height: 20px; border-radius: 10px; overflow: hidden;">
            <div id="progressBar"
                style="height: 100%; width: 0%; background: linear-gradient(to right, #4caf50, #81c784);">
            </div>
        </div>
    </div>

    <input type="text" id="todoInput" placeholder="è¼¸å…¥å¾…è¾¦äº‹é …..." style="font-size: large;">
    <input type="date" id="deadlineInput">
    <select id="categorySelect">
        <option value="å·¥ä½œ">å·¥ä½œ</option>
        <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
        <option value="å­¸ç¿’">å­¸ç¿’</option>
    </select>

    <button id="addBtn">æ–°å¢</button>

    <section style="text-align: right;">
        <input type="file" id="importFile" accept=".json">
        <button id="importBtn">ğŸ“¥ åŒ¯å…¥æ¸…å–®</button>
        <button id="exportBtn">ğŸ“¤ åŒ¯å‡ºæ¸…å–®</button>
    </section>

    <div class="filter-btns">
        <button class="filter active" data-filter="å…¨éƒ¨">å…¨éƒ¨</button>
        <button class="filter" data-filter="å·¥ä½œ">å·¥ä½œ</button>
        <button class="filter" data-filter="ç”Ÿæ´»">ç”Ÿæ´»</button>
        <button class="filter" data-filter="å­¸ç¿’">å­¸ç¿’</button>
    </div>

    <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹é—œéµå­—...">

    <ul id="todoList"></ul>

    <script>
        $(document).ready(function () {
            function updateProgress() {
                const total = $('#todoList li').length;
                const done = $('#todoList li.done').length;
                const percent = total === 0 ? 0 : Math.round((done / total) * 100);

                $('#progressText').text(`${percent}%`);
                $('#progressBar').css('width', `${percent}%`);
            }

            $('#importBtn').click(function () {
                const file = $('#importFile')[0].files[0];
                if (!file) {
                    alert('è«‹å…ˆé¸æ“‡ä¸€å€‹ .json æª”æ¡ˆ');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (!Array.isArray(data)) throw 'è³‡æ–™æ ¼å¼éŒ¯èª¤';

                        // æ¸…ç©ºç¾æœ‰æ¸…å–®
                        $('#todoList').empty();

                        // åŠ å…¥æ–°è³‡æ–™
                        data.forEach(todo => {
                            addTodo(todo.text, todo.deadline, todo.category, todo.done,);
                        });

                        saveTodos();
                        updateProgress();
                        alert('âœ… åŒ¯å…¥æˆåŠŸï¼');
                    } catch (err) {
                        alert('âŒ åŒ¯å…¥å¤±æ•—ï¼Œæª”æ¡ˆæ ¼å¼éŒ¯èª¤');
                    }
                };
                reader.readAsText(file);
            });

            $('#exportBtn').click(function () {
                const todos = localStorage.getItem('todoList') || '[]';
                const blob = new Blob([todos], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'my-todo-list.json';
                a.click();
                URL.revokeObjectURL(url);
            });

            // åˆå§‹åŒ– Dark Mode ç‹€æ…‹
            if (localStorage.getItem('darkMode') === 'on') {
                $('body').addClass('dark');
                $('#toggleDarkMode').text('â˜€ï¸ æ—¥é–“æ¨¡å¼');
            }

            // åˆ‡æ›æ¨¡å¼æŒ‰éˆ•
            $('#toggleDarkMode').click(function () {
                $('body').toggleClass('dark');
                const isDark = $('body').hasClass('dark');
                $(this).text(isDark ? 'â˜€ï¸ æ—¥é–“æ¨¡å¼' : 'ğŸŒ™ å¤œé–“æ¨¡å¼');
                localStorage.setItem('darkMode', isDark ? 'on' : 'off');
            });

            // åˆå§‹åŒ– Sortable
            new Sortable(document.getElementById('todoList'), {
                animation: 150,
                onEnd: function () {
                    saveTodos(); // æ‹–æ›³å¾Œé‡æ–°å„²å­˜é †åº
                    updateProgress();

                }
            });

            function saveTodos() {
                let todos = [];
                $('#todoList li').each(function () {
                    todos.push({
                        text: $(this).find('.item-text').text(),
                        deadline: $(this).data('deadline'),
                        category: $(this).data('category'),
                        done: $(this).hasClass('done')
                    });
                });
                localStorage.setItem('todoList', JSON.stringify(todos));
            }

            function loadTodos() {
                let saved = localStorage.getItem('todoList');
                if (saved) {
                    let todos = JSON.parse(saved);
                    todos.sort((a, b) => {
                        if (!a.deadline) return 1;
                        if (!b.deadline) return -1;
                        return a.deadline.localeCompare(b.deadline);
                    });
                    todos.forEach(todo => {
                        addTodo(todo.text, todo.deadline, todo.category, todo.done, false);
                        updateProgress();
                    });
                }
            }

            function addTodo(text, deadline = '', category = 'ç”Ÿæ´»', done = false, doSave = true) {
                let today = new Date().toISOString().split('T')[0];
                let isExpired = deadline && deadline < today;

                let newItem = $('<li></li>').html(`
          <div class="item-left">
            <span class="item-text">${text}</span>
            ${deadline ? `<span class="deadline ${isExpired ? 'expired' : ''}">
              æˆªæ­¢æ—¥æœŸï¼š${deadline}${isExpired ? 'ï¼ˆå·²é€¾æœŸï¼‰' : ''}
            </span>` : ''}
            <span class="tag ${category}">${category}</span>
          </div>
          <button class="delete-btn">âŒ</button>
        `);

                newItem.data('deadline', deadline);
                newItem.data('category', category);
                if (done) newItem.addClass('done');
                $('#todoList').append(newItem);
                sortTodoList();
                if (doSave) saveTodos();
                updateProgress();

            }

            function sortTodoList() {
                let items = $('#todoList li').get();
                items.sort(function (a, b) {
                    let ad = $(a).data('deadline');
                    let bd = $(b).data('deadline');
                    if (!ad) return 1;
                    if (!bd) return -1;
                    return ad.localeCompare(bd);
                });
                $('#todoList').empty().append(items);
                applyFilters();
            }

            $('#addBtn').click(function () {
                let text = $('#todoInput').val().trim();
                let deadline = $('#deadlineInput').val();
                let category = $('#categorySelect').val();
                if (text !== '') {
                    addTodo(text, deadline, category);
                    $('#todoInput').val('');
                    $('#deadlineInput').val('');
                }
            });

            $('#todoInput').keypress(function (e) {
                if (e.which === 13) $('#addBtn').click();
            });

            $('#todoList').on('click', '.item-text', function () {
                $(this).closest('li').toggleClass('done');
                saveTodos();
                updateProgress();

            });

            $('#todoList').on('click', '.delete-btn', function () {
                $(this).closest('li').slideUp(200, function () {
                    $(this).remove();
                    saveTodos();
                    updateProgress();

                });
            });

            $('.filter').click(function () {
                $('.filter').removeClass('active');
                $(this).addClass('active');
                applyFilters();
            });

            $('#searchInput').on('input', function () {
                applyFilters();
            });

            function applyFilters() {
                let currentFilter = $('.filter.active').data('filter');
                let keyword = $('#searchInput').val().toLowerCase();

                $('#todoList li').each(function () {
                    let itemCategory = $(this).data('category');
                    let itemText = $(this).find('.item-text').text().toLowerCase();

                    let matchCategory = (currentFilter === 'å…¨éƒ¨' || itemCategory === currentFilter);
                    let matchKeyword = (itemText.includes(keyword) || itemCategory.includes(keyword));

                    if (matchCategory && matchKeyword) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }

            loadTodos();
        });
    </script>

</body>

</html>